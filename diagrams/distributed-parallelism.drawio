<mxfile host="65bd71144e">
    <diagram id="distributed-parallelism" name="Distributed Parallelism">
        <mxGraphModel dx="1268" dy="715" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
            <root>
                <mxCell id="0"/>
                <mxCell id="1" parent="0"/>
                <mxCell id="title" value="vLLM Distributed Parallelism Strategies" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=18;fontStyle=1;fontColor=#333333;" parent="1" vertex="1">
                    <mxGeometry x="400" y="20" width="800" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="tp_border" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#2F5496;strokeWidth=2;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="30" y="80" width="360" height="400" as="geometry"/>
                </mxCell>
                <mxCell id="tp_title" value="Tensor Parallelism (TP)" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#2F5496;" parent="1" vertex="1">
                    <mxGeometry x="80" y="90" width="260" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="tp_layer" value="Single Layer (e.g., Attention)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#A5A5A5;fontColor=#FFFFFF;strokeColor=#757575;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="110" y="130" width="200" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="tp_split1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#2F5496;strokeWidth=2;" parent="1" source="tp_layer" target="tp_gpu0_q" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tp_split2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#2F5496;strokeWidth=2;" parent="1" source="tp_layer" target="tp_gpu1_q" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tp_gpu0_label" value="GPU 0" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=1;fontColor=#2F5496;" parent="1" vertex="1">
                    <mxGeometry x="39" y="180" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="tp_gpu1_label" value="GPU 1" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=1;fontColor=#2F5496;" parent="1" vertex="1">
                    <mxGeometry x="237" y="184" width="80" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="tp_gpu0_q" value="Q_proj&#10;(cols 0-2047)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4472C4;fontColor=#FFFFFF;strokeColor=#2F5496;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="50" y="200" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="tp_gpu0_k" value="K_proj&#10;(cols 0-2047)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4472C4;fontColor=#FFFFFF;strokeColor=#2F5496;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="50" y="260" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="tp_gpu0_v" value="V_proj&#10;(cols 0-2047)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4472C4;fontColor=#FFFFFF;strokeColor=#2F5496;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="50" y="320" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="tp_gpu1_q" value="Q_proj&#10;(cols 2048-4095)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4472C4;fontColor=#FFFFFF;strokeColor=#2F5496;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="250" y="200" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="tp_gpu1_k" value="K_proj&#10;(cols 2048-4095)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4472C4;fontColor=#FFFFFF;strokeColor=#2F5496;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="250" y="260" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="tp_gpu1_v" value="V_proj&#10;(cols 2048-4095)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4472C4;fontColor=#FFFFFF;strokeColor=#2F5496;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="250" y="320" width="120" height="50" as="geometry"/>
                </mxCell>
                <mxCell id="tp_allreduce" value="AllReduce" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFC000;fontColor=#333333;strokeColor=#BF9000;fontStyle=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="130" y="390" width="160" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="tp_ar_e1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#BF9000;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="tp_gpu0_v" target="tp_allreduce" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tp_ar_e2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#BF9000;strokeWidth=2;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="1" source="tp_gpu1_v" target="tp_allreduce" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="tp_note" value="Column-wise split" style="text;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=2;fontColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="130" y="435" width="160" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="pp_border" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#548235;strokeWidth=2;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="420" y="80" width="340" height="400" as="geometry"/>
                </mxCell>
                <mxCell id="pp_title" value="Pipeline Parallelism (PP)" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#548235;" parent="1" vertex="1">
                    <mxGeometry x="460" y="90" width="260" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="pp_gpu0_label" value="GPU 0" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=1;fontColor=#548235;" parent="1" vertex="1">
                    <mxGeometry x="530" y="125" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="pp_gpu0" value="Layers 0 – 15" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#70AD47;fontColor=#FFFFFF;strokeColor=#548235;fontStyle=1;fontSize=13;" parent="1" vertex="1">
                    <mxGeometry x="490" y="150" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="pp_p2p" value="P2P Transfer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFC000;fontColor=#333333;strokeColor=#BF9000;fontStyle=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="530" y="260" width="120" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="pp_e1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#548235;strokeWidth=2;" parent="1" source="pp_gpu0" target="pp_p2p" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="pp_gpu1_label" value="GPU 1" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=1;fontColor=#548235;" parent="1" vertex="1">
                    <mxGeometry x="510" y="305" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="pp_gpu1" value="Layers 16 – 31" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#70AD47;fontColor=#FFFFFF;strokeColor=#548235;fontStyle=1;fontSize=13;" parent="1" vertex="1">
                    <mxGeometry x="490" y="330" width="200" height="80" as="geometry"/>
                </mxCell>
                <mxCell id="pp_e2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#548235;strokeWidth=2;" parent="1" source="pp_p2p" target="pp_gpu1" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="pp_note" value="Sequential layer execution" style="text;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=2;fontColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="500" y="420" width="180" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="dp_border" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#C55A11;strokeWidth=2;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="790" y="80" width="360" height="400" as="geometry"/>
                </mxCell>
                <mxCell id="dp_title" value="Data Parallelism (DP)" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#C55A11;" parent="1" vertex="1">
                    <mxGeometry x="860" y="90" width="220" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="dp_lb" value="Load Balancer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFC000;fontColor=#333333;strokeColor=#BF9000;fontStyle=1;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="895" y="130" width="150" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="dp_replica0_label" value="Replica 0" style="text;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=1;fontColor=#C55A11;" parent="1" vertex="1">
                    <mxGeometry x="786" y="188" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="dp_gpu0" value="Full Model&#10;GPU 0" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ED7D31;fontColor=#FFFFFF;strokeColor=#C55A11;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="820" y="210" width="120" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="dp_gpu1" value="Full Model&#10;GPU 1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ED7D31;fontColor=#FFFFFF;strokeColor=#C55A11;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="820" y="275" width="120" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="dp_replica1_label" value="Replica 1" style="text;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=1;fontColor=#C55A11;" parent="1" vertex="1">
                    <mxGeometry x="967" y="190" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="dp_gpu2" value="Full Model&#10;GPU 2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ED7D31;fontColor=#FFFFFF;strokeColor=#C55A11;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="1000" y="210" width="120" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="dp_gpu3" value="Full Model&#10;GPU 3" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ED7D31;fontColor=#FFFFFF;strokeColor=#C55A11;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="1000" y="275" width="120" height="55" as="geometry"/>
                </mxCell>
                <mxCell id="dp_e1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#C55A11;strokeWidth=2;" parent="1" source="dp_lb" target="dp_gpu0" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="dp_e2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#C55A11;strokeWidth=2;" parent="1" source="dp_lb" target="dp_gpu2" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="dp_note" value="Requests distributed across replicas" style="text;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=2;fontColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="850" y="350" width="240" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="ep_border" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#4A1F6B;strokeWidth=2;dashed=1;" parent="1" vertex="1">
                    <mxGeometry x="1180" y="80" width="380" height="400" as="geometry"/>
                </mxCell>
                <mxCell id="ep_title" value="Expert Parallelism (EP)" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=14;fontStyle=1;fontColor=#4A1F6B;" parent="1" vertex="1">
                    <mxGeometry x="1250" y="90" width="240" height="30" as="geometry"/>
                </mxCell>
                <mxCell id="ep_router" value="Router / Gate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFC000;fontColor=#333333;strokeColor=#BF9000;fontStyle=1;fontSize=12;" parent="1" vertex="1">
                    <mxGeometry x="1300" y="130" width="140" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="ep_gpu0_label" value="GPU 0" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=1;fontColor=#4A1F6B;" parent="1" vertex="1">
                    <mxGeometry x="1210" y="185" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="ep_e0" value="Expert 0" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7030A0;fontColor=#FFFFFF;strokeColor=#4A1F6B;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1200" y="210" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="ep_e1" value="Expert 1" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7030A0;fontColor=#FFFFFF;strokeColor=#4A1F6B;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1275" y="210" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="ep_e2" value="Expert 2" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7030A0;fontColor=#FFFFFF;strokeColor=#4A1F6B;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1200" y="260" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="ep_e3" value="Expert 3" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7030A0;fontColor=#FFFFFF;strokeColor=#4A1F6B;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1275" y="260" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="ep_gpu1_label" value="GPU 1" style="text;html=1;align=center;verticalAlign=middle;fontSize=11;fontStyle=1;fontColor=#4A1F6B;" parent="1" vertex="1">
                    <mxGeometry x="1410" y="185" width="120" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="ep_e4" value="Expert 4" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7030A0;fontColor=#FFFFFF;strokeColor=#4A1F6B;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1400" y="210" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="ep_e5" value="Expert 5" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7030A0;fontColor=#FFFFFF;strokeColor=#4A1F6B;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1475" y="210" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="ep_e6" value="Expert 6" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7030A0;fontColor=#FFFFFF;strokeColor=#4A1F6B;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1400" y="260" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="ep_e7" value="Expert 7" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#7030A0;fontColor=#FFFFFF;strokeColor=#4A1F6B;fontSize=10;" parent="1" vertex="1">
                    <mxGeometry x="1475" y="260" width="70" height="40" as="geometry"/>
                </mxCell>
                <mxCell id="ep_re1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#4A1F6B;strokeWidth=2;" parent="1" source="ep_router" target="ep_e0" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ep_re2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#4A1F6B;strokeWidth=2;exitX=1;exitY=0.75;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" parent="1" source="ep_router" target="ep_e4" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ep_a2a" value="All-to-All Communication" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFC000;fontColor=#333333;strokeColor=#BF9000;fontStyle=1;fontSize=11;" parent="1" vertex="1">
                    <mxGeometry x="1270" y="330" width="200" height="35" as="geometry"/>
                </mxCell>
                <mxCell id="ep_a2a_e1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#BF9000;strokeWidth=2;" parent="1" source="ep_e3" target="ep_a2a" edge="1">
                    <mxGeometry relative="1" as="geometry"/>
                </mxCell>
                <mxCell id="ep_a2a_e2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#BF9000;strokeWidth=2;" parent="1" source="ep_e7" target="ep_a2a" edge="1">
                    <mxGeometry relative="1" as="geometry">
                        <Array as="points">
                            <mxPoint x="1510" y="310"/>
                            <mxPoint x="1370" y="310"/>
                        </Array>
                    </mxGeometry>
                </mxCell>
                <mxCell id="ep_note" value="MoE experts split across GPUs" style="text;html=1;align=center;verticalAlign=middle;fontSize=10;fontStyle=2;fontColor=#666666;" parent="1" vertex="1">
                    <mxGeometry x="1290" y="375" width="160" height="20" as="geometry"/>
                </mxCell>
                <mxCell id="footer" value="Ref: docs.vllm.ai/en/latest/serving/distributed_serving.html" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;fontSize=9;fontStyle=2;fontColor=#A5A5A5;" parent="1" vertex="1">
                    <mxGeometry x="550" y="510" width="400" height="30" as="geometry"/>
                </mxCell>
            </root>
        </mxGraphModel>
    </diagram>
</mxfile>